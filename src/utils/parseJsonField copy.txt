/**
 * Parses a JSON string from the request body if it exists and is a string
 * @param {object} reqBody - The request body object
 * @param {string} fieldName - The name of the field to parse
 * @param {boolean} [logMissing=false] - Whether to log if the field is missing
 * @returns {*} The parsed value, the original value if not a string, or undefined if the field doesn't exist
 */
function parseJsonField(reqBody, fieldName, logMissing = false) {
  // Check if field exists
  if (!reqBody.hasOwnProperty(fieldName)) {
    if (logMissing) {
      console.log(`${fieldName} is missing from req.body!`);
    }
    return undefined;
  }

  const fieldValue = reqBody[fieldName];

  // If it's already an object, return it directly
  if (typeof fieldValue === "object" && fieldValue !== null) {
    return fieldValue;
  }

  // If it's a string, try to parse it
  if (typeof fieldValue === "string") {
    try {
      return JSON.parse(fieldValue);
    } catch (error) {
      console.error(`Failed to parse ${fieldName}:`, error.message);
      return fieldValue; // Return original string if parsing fails
    }
  }

  // Return the value as-is for other types
  return fieldValue;
}

module.exports = parseJsonField;
